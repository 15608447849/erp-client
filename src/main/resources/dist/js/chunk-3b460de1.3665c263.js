(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3b460de1"],{4225:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"shoppingCart"},[s("van-nav-bar",{attrs:{title:"采购单",fixed:""},on:{"click-right":t.onClickEdit}},[s("van-icon",{directives:[{name:"show",rawName:"v-show",value:t.cart,expression:"cart"}],attrs:{slot:"left",size:"24px",color:"#666666",name:"arrow-left"},on:{click:t.toDetail},slot:"left"}),s("span",{attrs:{slot:"right"},slot:"right"},[t._v(t._s(t.edit))])],1),s("van-checkbox-group",{model:{value:t.checked,callback:function(e){t.checked=e},expression:"checked"}},t._l(t.list,function(e,a){return s("div",{key:a,staticClass:"content"},[s("div",{staticClass:"top"},[s("van-checkbox",{ref:"checkbox"+a,refInFor:!0,attrs:{disabled:2==t.status[a]||3==t.status[a],name:a,"checked-color":"#F91E1E"},on:{click:function(e){return e.stopPropagation(),t.changeBox(a)}}}),s("div",{staticClass:"img"},[s("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e.imgURl,expression:"goods.imgURl"}],key:e.imgURl,on:{click:function(e){return t.toPage(a)}}}),(2&e.consell)>0?s("img",{staticClass:"kongxiao",attrs:{src:i("7c12")}}):(1&e.consell)>0&&0==(2&e.consell)?s("img",{staticClass:"kongxiao",attrs:{src:i("bbeb")}}):t._e(),2==t.status[a]?s("div",{staticClass:"none",on:{click:function(e){return t.toPage(a)}}},[t._v("\n            已下架\n          ")]):t._e(),3==t.status[a]?s("div",{staticClass:"none",on:{click:function(e){return t.toPage(a)}}},[t._v("\n            库存不足\n          ")]):t._e(),e.isExCoupon?s("div",{staticClass:"isExCoupon"},[t._v("\n            无法使用优惠券\n          ")]):t._e()]),s("div",{staticClass:"right",on:{click:function(e){return t.toPage(a)}}},[s("div",{staticClass:"goodsName"},[t._v(t._s(e.ptitle)+" "+t._s(e.spec))]),s("div",{staticClass:"company"},[t._v(t._s(e.verdor))]),s("div",{staticClass:"package"},[t._v("中包装："+t._s(e.medpacknum)+"盒")]),s("div",{staticClass:"price"},[s("span",[t._v("￥"+t._s(t.Aprice[a]))]),s("span",[t._v("￥"+t._s(e.mp))])])])],1),s("div",{staticClass:"bottom"},[s("div"),s("van-stepper",{attrs:{integer:"",disabled:t.limitStep[a]||2==t.status[a]||3==t.status[a],step:e.medpacknum,max:e.limitsub,min:e.medpacknum,"disable-input":"","async-change":""},on:{minus:function(i){return t.reduceStep(e.num,a)},plus:function(i){return t.changeStep(e.num,a)},overlimit:function(i){return t.overlimit(e.num,a)}},model:{value:e.num,callback:function(i){t.$set(e,"num",i)},expression:"goods.num"}})],1),s("div",{staticClass:"activeInfo"},[t._l(e.currLadDesc,function(i,a,n){return e.exActivity?t._e():s("p",[t.activeCode(a)?s("van-tag",{attrs:{plain:"",type:"danger"}},[t._v(t._s(t.activeCode(a)))]):t._e(),t._l(i,function(i,n){return t.activeCode(a)?s("span",[t._v(t._s(i+e.nextLadDesc[a][n])+"\n            "),i||e.nextLadDesc[a][n]?s("span",[t._v(";")]):t._e()]):t._e()})],2)}),t._l(e.currLadDesc,function(i,a,n){return e.exActivity?s("p",{key:n},t._l(i,function(i,n){return t.activeCode(a)?s("van-tag",{key:n,attrs:{plain:"",type:"danger"}},[t._v(t._s(i+e.nextLadDesc[a][n]))]):t._e()}),1):t._e()})],2)])}),0),s("van-submit-bar",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],attrs:{price:t.price,loading:t.loading,disabled:t.submit,"button-text":"去结算"},on:{submit:t.onSubmit}},[s("van-checkbox",{attrs:{"checked-color":"#F91E1E"},on:{click:t.allSelect},model:{value:t.allS,callback:function(e){t.allS=e},expression:"allS"}},[t._v("全选")]),s("transition",{attrs:{name:"tip"}},[t.active.length>0?s("div",{class:t.tips},[t._l(t.active,function(e,i){return s("span",{key:i},[s("span",[t._v(t._s(e.offername.slice(0,2))+" : ")]),s("span",{staticStyle:{color:"#bbb"}},[t._v(t._s(e.nextladDesc?e.nextladDesc:e.currladDesc)+"； ")]),1==(1&i)?s("br"):t._e()])}),t.tipsC?s("div",{staticClass:"tipsClick",on:{click:t.tipsClick}},[t._v("\n          "+t._s(t.tipsClickText)+"\n        ")]):t._e()],2):t._e()])],1),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.show,expression:"!show"}],staticClass:"bottoms"},[s("van-checkbox",{attrs:{"checked-color":"#F91E1E"},on:{click:t.allSelect},model:{value:t.allS,callback:function(e){t.allS=e},expression:"allS"}},[t._v("全选")]),s("span",[s("button",{on:{click:function(e){return e.stopPropagation(),t.collection(e)}}},[t._v("添加至收藏")]),s("button",{on:{click:function(e){return e.stopPropagation(),t.delGoods(e)}}},[t._v("删除")])])],1),t.flag?s("div",{staticClass:"flag"}):t._e()],1)},a=[],n=(i("ac6a"),i("a481"),i("0439")),c={data:function(){return{checked:[],edit:"编辑",list:[],show:!0,allS:!1,unqids:"",skus:"",price:0,flag:!1,active:[],loading:!1,cart:!1,limitStep:[],timer:null,status:[],Aprice:[],arrlimits:[],ruleCodeToText:{1110:"满减-现金",1120:"满减-包邮",1130:"满减-折扣",1210:"满赠-返利",1220:"满赠-包邮券",1230:"满赠-折扣券",1240:"满赠-赠品",1133:"团购",1113:"秒杀"},listImg:[],checkedList:[],tips:"tips",tipsClickText:"展开",tipsC:!0,actives:{},againShopping:!1}},created:function(){this.$store.commit(n["d"],2)},computed:{userInfo:function(){return this.$loadUserInfo()},submit:function(){return!(this.checked.length>0)}},mounted:function(){this.cart=this.$route.query.cart},activated:function(){this.getGoodsInfo()},methods:{toPage:function(t){this.$router.push({name:"goodsDetail",query:{sku:this.list[t].sku}})},toDetail:function(){this.$router.replace({name:"goodsDetail"})},onClickEdit:function(){var t=this;this.checkedList=[],this.show=!this.show,this.checked=[],this.allS=!1,this.getOfferTip(),this.price=0,this.unqids="","编辑"===this.edit?(this.edit="取消",this.status.forEach(function(e,i){t.status[i]=0})):(this.edit="编辑",this.list.forEach(function(e,i){t.status[i]=e.status}))},collection:function(){var t=this;""!==this.skus.slice(1)?JNB.query({serverName:"orderServer"+this.$ser_in(this.userInfo.comp.storeId),cls:"MyCollectModule",method:"add",params:{ids:this.skus.slice(1)},callback:function(e){var i=JSON.parse(e);200==i.code?t.$toast("收藏成功~"):t.$toast.fail(i.message)}}):this.$toast("请选择需要收藏的商品~")},changeStep:function(t,e){var i=this;null!==this.timer&&window.clearTimeout(this.timer),this.timer=setTimeout(function(){i.$manageGoodNum(i,{sku:i.list[e].sku},t).then(function(){i.getGoodsInfo()}),i.changeBox(e)},500)},reduceStep:function(t,e){var i=this;null!==this.timer&&window.clearTimeout(this.timer),this.timer=setTimeout(function(){i.$manageGoodNum(i,{sku:i.list[e].sku},t).then(function(){i.getGoodsInfo()}),i.changeBox(e)},500)},overlimit:function(t,e){t>=this.list[e].limitsub?this.$toast("超过购买限制了哟~"):t<=this.list[e].medpacknum&&this.$toast("受不了了，商品不能再减少了~")},delGoods:function(){var t=this;""!==this.unqids?JNB.query({serverName:"orderServer"+this.$ser_in(this.userInfo.comp.storeId),cls:"ShoppingCartModule",method:"clearShopCart",params:{compid:this.userInfo.comp.storeId,ids:this.unqids.slice(1)},callback:function(e){t.checkedList=[];var i=JSON.parse(e);200===i.code?(t.getGoodsInfo(),t.price=0,t.$toast("删除成功！"),t.active=[],t.checked=[],t.allS=!1):t.$toast.fail(i.message)}}):this.$toast("请选择需要删除的商品！")},allSelect:function(){var t=this;this.allS=!this.allS,this.unqids="",this.skus="",this.price=0,this.checked=[],this.allS?(this.list.forEach(function(e,i){2!==e.status&&3!==e.status?t.checked.push(i):"取消"==t.edit&&t.checked.push(i),t.checkedList[i]=!0}),this.getOfferTip()):(this.checked=[],this.unqids="",this.skus="",this.active=[],this.checkedList=[]),this.checked.forEach(function(e){t.unqids+=","+t.list[e].unqid,t.skus+=","+t.list[e].sku,t.price+=t.Aprice[e]*t.list[e].num*100})},changeBox:function(t){var e=this;this.unqids="",this.skus="",setTimeout(function(){e.price=0,e.checked.forEach(function(t){e.unqids+=","+e.list[t].unqid,e.skus+=","+e.list[t].sku,e.price+=e.Aprice[t]*e.list[t].num*100}),e.list.length===e.checked.length?e.allS=!0:e.allS=!1,e.getOfferTip(),e.checkedList[t]=e.$refs["checkbox"+t][0].checked},100)},getGoodsInfo:function(){var t=this;JNB.query({serverName:"orderServer"+this.$ser_in(this.userInfo.comp.storeId),cls:"ShoppingCartModule",method:"queryUnCheckShopCartList",params:{compid:this.userInfo.comp.storeId},callback:function(e){var i=JSON.parse(e);200===i.code&&i.data?(i.data.length<1?t.flag=!0:t.flag=!1,i.data.length>0&&(i.data.forEach(function(e,i){e.skprice>0?t.Aprice.push(e.skprice):t.Aprice.push(e.pdprice),t.status.push(e.status),e.sku=e.pdno,0===e.limitnum&&(e.limitsub=e.inventory),e.actstock<e.limitsub&&(e.limitsub=e.actstock),t.getActive(e.sku,i)}),t.$request_img({context:t,arr:i.data,cacheImg:!0})),t.list=i.data,t.$route.query.againShopping&&t.allSelect()):(t.list=[],t.flag=!0)}})},getActive:function(t,e){var i=this;JNB.query({serverName:"orderServer"+this.$ser_in(this.userInfo.comp.storeId),cls:"CalculateModule",method:"getActivitiesBySKU",params:[t,this.userInfo.comp.storeId],callback:function(t){var s=JSON.parse(t);200===s.code&&s.data.discounts.length>0&&(i.discounts=s.data.discounts,s.data.minimum<i.list[e].limitsub&&(i.list[e].limitsub=s.data.minimum))}})},onSubmit:function(){var t=this;this.loading=!0;var e=this.checked.map(function(e){return{pdno:t.list[e].sku,pnum:t.list[e].num,compid:t.userInfo.comp.storeId,checked:1,unqid:t.list[e].unqid,conpno:0,areano:t.userInfo.comp.addressCode,pdprice:t.list[e].pdprice}});JNB.query({serverName:"orderServer"+this.$ser_in(this.userInfo.comp.storeId),cls:"ShoppingCartModule",method:"querySettShopCartList",params:e,callback:function(e){var i=JSON.parse(e);200==i.code?(t.checked.forEach(function(e,s){i.data.goods[s].imgURl=t.list[e].imgURl}),t.$router.push({path:"/goodsOrder",query:{placeType:2}}),sessionStorage.setItem("placeOrderList",JSON.stringify(i.data.goods)),sessionStorage.setItem("activeOrderList",JSON.stringify(i.data.gifts)),t.loading=!1):(t.loading=!1,t.$toast.fail(i.message))}})},getOfferTip:function(){var t=this,e=[];this.checked.forEach(function(i){e.push({compid:t.userInfo.comp.storeId,pdno:t.list[i].pdno,pnum:t.list[i].num,checked:1,unqid:t.list[i].unqid})}),JNB.query({serverName:"orderServer"+this.$ser_in(this.userInfo.comp.storeId),cls:"ShoppingCartModule",method:"getOfferTip",params:e,callback:function(e){var i=JSON.parse(e);200==i.code&&i.data?(t.actives=i.data,t.active=i.data.slice(0,6),i.data.length<7?(t.tips="tipsA",t.tipsC=!1,t.tipsClickText="收起"):(t.tips="tips",t.tipsC=!0,t.tipsClickText="展开")):t.active=[]}})},activeCode:function(t){var e=this.ruleCodeToText[t];return e},tipsClick:function(){"tips"==this.tips?(this.tips="tipsA",this.tipsClickText="收起",this.active=this.actives):(this.tips="tips",this.tipsClickText="展开",this.active=this.actives.slice(0,6))}}},o=c,r=(i("8e85"),i("2877")),l=Object(r["a"])(o,s,a,!1,null,"2a14a586",null);e["default"]=l.exports},"771a":function(t,e,i){},"7c12":function(t,e,i){t.exports=i.p+"img/consell-tag-1.c0c4a1dc.png"},"8e85":function(t,e,i){"use strict";var s=i("771a"),a=i.n(s);a.a},a481:function(t,e,i){"use strict";var s=i("cb7c"),a=i("4bf8"),n=i("9def"),c=i("4588"),o=i("0390"),r=i("5f1b"),l=Math.max,u=Math.min,d=Math.floor,h=/\$([$&`']|\d\d?|<[^>]*>)/g,p=/\$([$&`']|\d\d?)/g,v=function(t){return void 0===t?t:String(t)};i("214f")("replace",2,function(t,e,i,f){return[function(s,a){var n=t(this),c=void 0==s?void 0:s[e];return void 0!==c?c.call(s,n,a):i.call(String(n),s,a)},function(t,e){var a=f(i,t,this,e);if(a.done)return a.value;var d=s(t),h=String(this),p="function"===typeof e;p||(e=String(e));var g=d.global;if(g){var k=d.unicode;d.lastIndex=0}var b=[];while(1){var _=r(d,h);if(null===_)break;if(b.push(_),!g)break;var S=String(_[0]);""===S&&(d.lastIndex=o(h,n(d.lastIndex),k))}for(var C="",x=0,I=0;I<b.length;I++){_=b[I];for(var y=String(_[0]),$=l(u(c(_.index),h.length),0),w=[],q=1;q<_.length;q++)w.push(v(_[q]));var N=_.groups;if(p){var T=[y].concat(w,$,h);void 0!==N&&T.push(N);var E=String(e.apply(void 0,T))}else E=m(y,h,$,w,N,e);$>=x&&(C+=h.slice(x,$)+E,x=$+y.length)}return C+h.slice(x)}];function m(t,e,s,n,c,o){var r=s+t.length,l=n.length,u=p;return void 0!==c&&(c=a(c),u=h),i.call(o,u,function(i,a){var o;switch(a.charAt(0)){case"$":return"$";case"&":return t;case"`":return e.slice(0,s);case"'":return e.slice(r);case"<":o=c[a.slice(1,-1)];break;default:var u=+a;if(0===u)return i;if(u>l){var h=d(u/10);return 0===h?i:h<=l?void 0===n[h-1]?a.charAt(1):n[h-1]+a.charAt(1):i}o=n[u-1]}return void 0===o?"":o})}})},bbeb:function(t,e,i){t.exports=i.p+"img/consell-tag-0.8a1b22a6.png"}}]);
//# sourceMappingURL=chunk-3b460de1.3665c263.js.map