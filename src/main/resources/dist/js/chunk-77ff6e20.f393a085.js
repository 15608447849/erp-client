(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-77ff6e20"],{2325:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticStyle:{"padding-bottom":"20px"}},[s("van-nav-bar",{attrs:{title:"申请售后","left-text":"","left-arrow":""},on:{"click-left":function(t){return e.$toPage(-1)}}}),s("van-cell-group",[s("van-cell",{attrs:{required:!0,title:"售后类型",value:e.asTypeIndex||0==e.asTypeIndex?e.asTypeList[e.asTypeIndex].name:"请选择售后类型"},on:{click:e.selectTypeShow}}),s("van-actionsheet",{attrs:{title:"请选择类型"},model:{value:e.show_0,callback:function(t){e.show_0=t},expression:"show_0"}},[s("van-cell-group",{staticClass:"text_center"},e._l(e.asTypeList,function(t,a){return s("van-cell",{key:a,attrs:{title:t.name},on:{click:function(t){return e.selectedType(a)}}})}),1)],1),s("van-cell",{attrs:{required:!0,title:"退款原因",value:e.saleReasonIndex||0==e.saleReasonIndex?e.saleReasonList[e.saleReasonIndex].label:"请选择退款原因"},on:{click:e.selectReasonShow}}),s("van-actionsheet",{attrs:{title:"请选择退款原因"},model:{value:e.show_1,callback:function(t){e.show_1=t},expression:"show_1"}},[s("van-cell-group",{staticClass:"text_center"},e._l(e.saleReasonList,function(t,a){return s("van-cell",{key:a,staticClass:"out",attrs:{title:t.label},on:{click:function(t){return e.selectedReason(a)}}})}),1)],1),s("van-field",{attrs:{label:"原因描述",type:"textarea",placeholder:"请简单描述退货原因",rows:"4",autosize:""},model:{value:e.apdesc,callback:function(t){e.apdesc=t},expression:"apdesc"}}),s("van-cell",{staticClass:"border_bottom_none",attrs:{required:!0,title:"上传图片"}}),s("div",{staticClass:"img_box"},[e._l(e.imgList,function(t,a){return s("div",{key:a,staticClass:"img_box_0"},[s("div",{staticClass:"img_box_0_0"},[s("img",{attrs:{src:t},on:{click:function(t){return e.viewImg(a)}}}),s("van-icon",{staticClass:"cross_btn",attrs:{name:"cross",size:"16px"},on:{click:function(t){return e.deleteImg(a)}}})],1)])}),e.addImgShow?s("div",{staticClass:"img_box_0",on:{click:function(t){return e.img_select()}}},[s("div",{staticClass:"addImg"},[s("van-icon",{attrs:{name:"plus",size:"60px",color:"#999999"}})],1)]):e._e()],2)],1),s("h3",[e._v("选择退货商品")]),e._l(e.goodList,function(t,a){return s("van-card",{key:a,staticStyle:{"background-color":"#FFFFFF"},attrs:{title:t.pname,desc:t.manun,price:t.pdprice,num:t.pnum,thumb:t.imgURl}},[s("div",{staticStyle:{display:"flex","justify-content":"flex-end",position:"relative"},attrs:{slot:"bottom"},slot:"bottom"},[s("van-stepper",{attrs:{min:"0",max:t.pnum},model:{value:t._num,callback:function(s){e.$set(t,"_num",s)},expression:"item._num"}}),s("van-checkbox",{staticClass:"selected-btn",attrs:{"checked-color":"#07c160"},model:{value:t._selected,callback:function(s){e.$set(t,"_selected",s)},expression:"item._selected"}})],1)])}),s("div",{staticClass:"button_box",on:{click:e.submitInfo}},[e._v("提交")]),s("van-image-preview",{attrs:{images:e.imgList,startPosition:e.show_img_index},model:{value:e.show_img,callback:function(t){e.show_img=t},expression:"show_img"}})],2)},o=[],i=(s("ac6a"),s("b970")),n={data:function(){return{orderNo:null,asTypeIndex:null,asTypeList:[{name:"退货退款",val:"1"},{name:"仅退款",val:"2"}],show_0:!1,saleReasonIndex:null,saleReasonList:[],show_1:!1,apdesc:"",imgList:[],addImgShow:!0,show_img:!1,show_img_index:0,goodList:[],canSubmit:!0}},mounted:function(){this.orderNo=this.$route.query.orderNo,this.getDicts(),this.getGoodsList()},methods:{getDicts:function(){var e=this;JNB.query({serverName:"globalServer",cls:"CommonModule",method:"getDicts",params:{},callback:function(t){t=JSON.parse(t),200==t.code&&(t.data=JSON.parse(t.data),e.saleReasonList=t.data.reprreason)}})},selectTypeShow:function(){this.show_0=!0},selectedType:function(e){this.asTypeIndex=e,this.show_0=!1},selectReasonShow:function(){this.show_1=!0},selectedReason:function(e){this.saleReasonIndex=e,this.show_1=!1},img_select:function(){var e=this;JNB._requestNative("openImageSelect",function(t){t&&(e.imgList.push(t),e.imgList.length>2&&(e.addImgShow=!1))})},deleteImg:function(e){this.imgList.splice(e,1),this.imgList.length<3&&(this.addImgShow=!0)},viewImg:function(e){this.show_img=!0,this.show_img_index=e},getGoodsList:function(){var e=this;JNB.query({serverName:"orderServer"+this.$ser_in(this.$loadUserInfo().comp.storeId),cls:"OrderInfoModule",method:"getOrderDetail",params:[this.$loadUserInfo().comp.storeId,this.orderNo],callback:function(t){t=JSON.parse(t),200===t.code?(t.data.goods[0].goods.forEach(function(e){e._num=0,e._selected=!1}),e.$request_img({context:e,arr:t.data.goods[0].goods,skuName:"pdno"}),e.goodList=t.data.goods[0].goods):e.$toast(t.message)}})},submitInfo:function(){var e=this;if(this.canSubmit){if(this.canSubmit=!1,!this.asTypeIndex&&0!=this.asTypeIndex)return this.$toast("请先选择售后类型"),void(this.canSubmit=!0);if(!this.saleReasonIndex&&0!=this.saleReasonIndex)return this.$toast("请先选择退款原因"),void(this.canSubmit=!0);if(0==this.imgList.length)return this.canSubmit=!0,void this.$toast("请上传图片");for(var t=!1,s=0;s<this.goodList.length;s++)this.goodList[s]._selected&&this.goodList[s]._num>0&&(t=!0);if(!t)return this.canSubmit=!0,void this.$toast("请选择商品");i["b"].loading({mask:!0,duration:"toast",message:"加载中..."}),JNB.query({serverName:"globalServer",cls:"FileInfoModule",method:"fileServerInfo",params:{compid:this.goodList[0].compid,orderid:this.goodList[0].orderno},callback:function(t){t=JSON.parse(t).data;for(var s=t.upUrl,a=t.orderFilePath,o=[],n=0;n<e.imgList.length;n++){var r=e.imgList[n];"image"===r.slice(0,5)&&o.push({remotePath:a,fileName:n+".png",uri:r})}o.length>0?JNB._requestNative("fileUpload",JSON.stringify({url:s,files:o}),function(t){if(t=JSON.parse(t),200==t.code){for(var s={asAppArr:[],orderno:e.orderNo,asType:e.asTypeList[e.asTypeIndex].val},a=0;a<e.goodList.length;a++)e.goodList[a]._selected&&e.goodList[a]._num>0&&(i["b"].clear(),s.asAppArr.push({gstatus:0,asnum:e.goodList[a]._num,pdno:e.goodList[a].pdno,orderno:e.goodList[a].orderno,compid:e.goodList[a].compid,reason:e.saleReasonList[e.saleReasonIndex].value,apdesc:e.apdesc,astype:e.asTypeList[e.asTypeIndex].val}));JNB.query({serverName:"orderServer"+e.$ser_in(e.$loadUserInfo().comp.storeId),cls:"OrderOptModule",method:"afterSaleApp",params:s,callback:function(t){t=JSON.parse(t),200==t.code?(e.$router.push({path:"/serviceAfterSalesRecord",query:{canBack:0}}),i["b"].clear(),e.canSubmit=!0):(i["b"].clear(),e.$toast(t.message),e.canSubmit=!0)}})}else e.canSubmit=!0,i["b"].clear(),e.$toast(t.message)}):(e.canSubmit=!0,i["b"].clear())}})}}}},r=n,l=(s("7915"),s("2877")),c=Object(l["a"])(r,a,o,!1,null,"c216e582",null);t["default"]=c.exports},"54bd":function(e,t,s){},7915:function(e,t,s){"use strict";var a=s("54bd"),o=s.n(a);o.a}}]);
//# sourceMappingURL=chunk-77ff6e20.f393a085.js.map